/*
Copyright 2014 Paul Sidnell

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
package org.psidnell.omnifocus.format;

import java.io.StringWriter;

import org.junit.Test;
import org.psidnell.omnifocus.OFExport;
import org.psidnell.omnifocus.integrationtest.Diff;

public class XMLTest extends FormatTest {

    @Test
    public void testProjectMode () throws Exception {
        OFExport ofExport = new OFExport();
        ofExport.getProjectRoot().add(f1);
        ofExport.setFormat("XML");
        ofExport.process();
        StringWriter out = new StringWriter();
        ofExport.write(out);

        Diff.diff (new String[]
            {
                "<Folder>",
                "  <active>true</active>",
                "  <dropped>false</dropped>",
                "  <folders>",
                "    <folders>",
                "      <active>true</active>",
                "      <dropped>false</dropped>",
                "      <folders/>",
                "      <id>%%%%f1</id>",
                "      <name>f1</name>",
                "      <parentFolderId/>",
                "      <projects>",
                "        <projects>",
                "          <active>false</active>",
                "          <completed>false</completed>",
                "          <completionDate/>",
                "          <contextName/>",
                "          <deferDate/>",
                "          <dropped>false</dropped>",
                "          <dueDate/>",
                "          <estimatedMinutes>-1</estimatedMinutes>",
                "          <flagged>false</flagged>",
                "          <id>%%%%p1</id>",
                "          <name>p1</name>",
                "          <note/>",
                "          <onHold>false</onHold>",
                "          <rank>0</rank>",
                "          <remaining>true</remaining>",
                "          <sequential>false</sequential>",
                "          <singleActionList>false</singleActionList>",
                "          <status>status</status>",
                "          <tasks>",
                "            <tasks>",
                "              <available>false</available>",
                "              <blocked>false</blocked>",
                "              <completed>false</completed>",
                "              <completionDate/>",
                "              <contextId/>",
                "              <contextName/>",
                "              <deferDate>1417046400000</deferDate>",
                "              <dueDate/>",
                "              <estimatedMinutes>-1</estimatedMinutes>",
                "              <flagged>true</flagged>",
                "              <id>%%%%t1</id>",
                "              <name>t1</name>",
                "              <note/>",
                "              <parentTaskId/>",
                "              <projectTask>false</projectTask>",
                "              <rank>0</rank>",
                "              <remaining>true</remaining>",
                "              <sequential>false</sequential>",
                "              <tasks/>",
                "            </tasks>",
                "            <tasks>",
                "              <available>false</available>",
                "              <blocked>false</blocked>",
                "              <completed>false</completed>",
                "              <completionDate/>",
                "              <contextId/>",
                "              <contextName>c1</contextName>",
                "              <deferDate/>",
                "              <dueDate>1417046400000</dueDate>",
                "              <estimatedMinutes>-1</estimatedMinutes>",
                "              <flagged>false</flagged>",
                "              <id>%%%%t2</id>",
                "              <name>t2</name>",
                "              <note>line1",
                "line2</note>",
                "              <parentTaskId/>",
                "              <projectTask>false</projectTask>",
                "              <rank>0</rank>",
                "              <remaining>true</remaining>",
                "              <sequential>false</sequential>",
                "              <tasks/>",
                "            </tasks>",
                "            <tasks>",
                "              <available>false</available>",
                "              <blocked>false</blocked>",
                "              <completed>true</completed>",
                "              <completionDate>1417046400000</completionDate>",
                "              <contextId/>",
                "              <contextName>c2</contextName>",
                "              <deferDate/>",
                "              <dueDate/>",
                "              <estimatedMinutes>-1</estimatedMinutes>",
                "              <flagged>false</flagged>",
                "              <id>%%%%t3</id>",
                "              <name>t3</name>",
                "              <note>line1",
                "line2</note>",
                "              <parentTaskId/>",
                "              <projectTask>false</projectTask>",
                "              <rank>0</rank>",
                "              <remaining>false</remaining>",
                "              <sequential>false</sequential>",
                "              <tasks>",
                "                <tasks>",
                "                  <available>false</available>",
                "                  <blocked>false</blocked>",
                "                  <completed>true</completed>",
                "                  <completionDate>1417046400000</completionDate>",
                "                  <contextId/>",
                "                  <contextName>c2</contextName>",
                "                  <deferDate/>",
                "                  <dueDate/>",
                "                  <estimatedMinutes>-1</estimatedMinutes>",
                "                  <flagged>false</flagged>",
                "                  <id>%%%%t4</id>",
                "                  <name>t4</name>",
                "                  <note>line1",
                "line2</note>",
                "                  <parentTaskId/>",
                "                  <projectTask>false</projectTask>",
                "                  <rank>0</rank>",
                "                  <remaining>false</remaining>",
                "                  <sequential>false</sequential>",
                "                  <tasks/>",
                "                </tasks>",
                "              </tasks>",
                "            </tasks>",
                "          </tasks>",
                "        </projects>",
                "        <projects>",
                "          <active>false</active>",
                "          <completed>false</completed>",
                "          <completionDate>1417046400000</completionDate>",
                "          <contextName/>",
                "          <deferDate/>",
                "          <dropped>false</dropped>",
                "          <dueDate>1417046400000</dueDate>",
                "          <estimatedMinutes>-1</estimatedMinutes>",
                "          <flagged>true</flagged>",
                "          <id>%%%%p2</id>",
                "          <name>p2</name>",
                "          <note>line1",
                "line2</note>",
                "          <onHold>false</onHold>",
                "          <rank>0</rank>",
                "          <remaining>true</remaining>",
                "          <sequential>false</sequential>",
                "          <singleActionList>false</singleActionList>",
                "          <status>status</status>",
                "          <tasks/>",
                "        </projects>",
                "        <projects>",
                "          <active>false</active>",
                "          <completed>false</completed>",
                "          <completionDate/>",
                "          <contextName/>",
                "          <deferDate/>",
                "          <dropped>false</dropped>",
                "          <dueDate/>",
                "          <estimatedMinutes>-1</estimatedMinutes>",
                "          <flagged>false</flagged>",
                "          <id>%%%%p3</id>",
                "          <name>p3</name>",
                "          <note/>",
                "          <onHold>false</onHold>",
                "          <rank>0</rank>",
                "          <remaining>true</remaining>",
                "          <sequential>false</sequential>",
                "          <singleActionList>false</singleActionList>",
                "          <status>status</status>",
                "          <tasks/>",
                "        </projects>",
                "      </projects>",
                "      <rank>0</rank>",
                "    </folders>",
                "  </folders>",
                "  <id>__%%RootFolder</id>",
                "  <name>RootFolder</name>",
                "  <parentFolderId/>",
                "  <projects/>",
                "  <rank>0</rank>",
                "</Folder>",
            }, out.toString().split("\n"));
    }

    @Test
    public void testContextMode () throws Exception {
        OFExport ofExport = new OFExport();
        ofExport.setProjectMode(false);
        ofExport.getContextRoot().add(c1);
        ofExport.setFormat("XML");
        ofExport.process();
        StringWriter out = new StringWriter();
        ofExport.write(out);

        Diff.diff (new String[]
            {
                "<Context>",
                "  <active>true</active>",
                "  <activeFlag>true</activeFlag>",
                "  <allowsNextAction>true</allowsNextAction>",
                "  <contexts>",
                "    <contexts>",
                "      <active>true</active>",
                "      <activeFlag>true</activeFlag>",
                "      <allowsNextAction>true</allowsNextAction>",
                "      <contexts>",
                "        <contexts>",
                "          <active>true</active>",
                "          <activeFlag>true</activeFlag>",
                "          <allowsNextAction>true</allowsNextAction>",
                "          <contexts/>",
                "          <dropped>false</dropped>",
                "          <id>%%%%c2</id>",
                "          <name>c2</name>",
                "          <onHold>false</onHold>",
                "          <parentContextId/>",
                "          <rank>0</rank>",
                "          <tasks>",
                "            <tasks>",
                "              <available>false</available>",
                "              <blocked>false</blocked>",
                "              <completed>true</completed>",
                "              <completionDate>1417046400000</completionDate>",
                "              <contextId/>",
                "              <contextName>c2</contextName>",
                "              <deferDate/>",
                "              <dueDate/>",
                "              <estimatedMinutes>-1</estimatedMinutes>",
                "              <flagged>false</flagged>",
                "              <id>%%%%t3</id>",
                "              <name>t3</name>",
                "              <note>line1",
                "line2</note>",
                "              <parentTaskId/>",
                "              <projectTask>false</projectTask>",
                "              <rank>0</rank>",
                "              <remaining>false</remaining>",
                "              <sequential>false</sequential>",
                "              <tasks>",
                "                <tasks>",
                "                  <available>false</available>",
                "                  <blocked>false</blocked>",
                "                  <completed>true</completed>",
                "                  <completionDate>1417046400000</completionDate>",
                "                  <contextId/>",
                "                  <contextName>c2</contextName>",
                "                  <deferDate/>",
                "                  <dueDate/>",
                "                  <estimatedMinutes>-1</estimatedMinutes>",
                "                  <flagged>false</flagged>",
                "                  <id>%%%%t4</id>",
                "                  <name>t4</name>",
                "                  <note>line1",
                "line2</note>",
                "                  <parentTaskId/>",
                "                  <projectTask>false</projectTask>",
                "                  <rank>0</rank>",
                "                  <remaining>false</remaining>",
                "                  <sequential>false</sequential>",
                "                  <tasks/>",
                "                </tasks>",
                "              </tasks>",
                "            </tasks>",
                "            <tasks>",
                "              <available>false</available>",
                "              <blocked>false</blocked>",
                "              <completed>true</completed>",
                "              <completionDate>1417046400000</completionDate>",
                "              <contextId/>",
                "              <contextName>c2</contextName>",
                "              <deferDate/>",
                "              <dueDate/>",
                "              <estimatedMinutes>-1</estimatedMinutes>",
                "              <flagged>false</flagged>",
                "              <id>%%%%t4</id>",
                "              <name>t4</name>",
                "              <note>line1",
                "line2</note>",
                "              <parentTaskId/>",
                "              <projectTask>false</projectTask>",
                "              <rank>0</rank>",
                "              <remaining>false</remaining>",
                "              <sequential>false</sequential>",
                "              <tasks/>",
                "            </tasks>",
                "          </tasks>",
                "        </contexts>",
                "      </contexts>",
                "      <dropped>false</dropped>",
                "      <id>%%%%c1</id>",
                "      <name>c1</name>",
                "      <onHold>false</onHold>",
                "      <parentContextId/>",
                "      <rank>0</rank>",
                "      <tasks>",
                "        <tasks>",
                "          <available>false</available>",
                "          <blocked>false</blocked>",
                "          <completed>false</completed>",
                "          <completionDate/>",
                "          <contextId/>",
                "          <contextName>c1</contextName>",
                "          <deferDate/>",
                "          <dueDate>1417046400000</dueDate>",
                "          <estimatedMinutes>-1</estimatedMinutes>",
                "          <flagged>false</flagged>",
                "          <id>%%%%t2</id>",
                "          <name>t2</name>",
                "          <note>line1",
                "line2</note>",
                "          <parentTaskId/>",
                "          <projectTask>false</projectTask>",
                "          <rank>0</rank>",
                "          <remaining>true</remaining>",
                "          <sequential>false</sequential>",
                "          <tasks/>",
                "        </tasks>",
                "      </tasks>",
                "    </contexts>",
                "  </contexts>",
                "  <dropped>false</dropped>",
                "  <id>__%%RootContext</id>",
                "  <name>RootContext</name>",
                "  <onHold>false</onHold>",
                "  <parentContextId/>",
                "  <rank>0</rank>",
                "  <tasks/>",
                "</Context>",
            }, out.toString().split("\n"));
    }
}
